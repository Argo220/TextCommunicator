@using TextCommunicator.Data
@{
    ViewData["Title"] = "Utwórz grupę";
    var users = (List<ApplicationUser>)ViewBag.Users;
}

<div class="card">
    <h2>Utwórz grupę (Admin)</h2>

    @if (TempData["Err"] is not null)
    {
        <div class="alert">@TempData["Err"]</div>
    }

    <form method="post">
        <div class="form-group">
            <label>Nazwa grupy</label>
            <input name="name" class="form-control" />
        </div>

        <div class="form-group">
    <label>Użytkownicy w grupie</label>

    <div class="row gap" style="margin:8px 0 10px 0;">
        <button id="btnSelectAllUsers" class="btn btn-secondary" type="button">Zaznacz wszystkich</button>
        <button id="btnClearAllUsers" class="btn btn-secondary" type="button">Odznacz wszystkich</button>
    </div>

    <div class="grid">
                @foreach (var u in users)
                {
                    <label class="check">
                        <input type="checkbox" name="userIds" value="@u.Id" />
                        <span>@u.Email</span>
                    </label>
                }
            </div>
        </div>

        <div class="row gap">
            <button class="btn" type="submit">Utwórz</button>
            <a class="btn btn-secondary" asp-action="Index">Anuluj</a>
        </div>
    </form>
</div>


@section Scripts {
    <script>
        (function(){
            const all = () => Array.from(document.querySelectorAll('input[name="userIds"]'));
            const selAll = document.getElementById("btnSelectAllUsers");
            const clrAll = document.getElementById("btnClearAllUsers");
            if (selAll) selAll.addEventListener("click", () => all().forEach(x => x.checked = true));
            if (clrAll) clrAll.addEventListener("click", () => all().forEach(x => x.checked = false));
        })();
    </script>
}
