@model List<TextCommunicator.Controllers.GroupsController.AddUserRowVm>
@{
    ViewData["Title"] = "Dodaj użytkowników";
    var groupId = (int)ViewBag.GroupId;
    var groupName = (string)ViewBag.GroupName;
}

<div class="card">
    <div class="row space-between">
        <h2>Dodaj użytkowników do: @groupName</h2>
        <a class="btn btn-secondary" asp-action="Members" asp-route-id="@groupId">← Członkowie</a>
    </div>

    <div class="form-group">
        <input id="searchAddUsers" class="form-control" placeholder="Szukaj..." autocomplete="off" />
    </div>

    <form method="post">
        <input type="hidden" name="groupId" value="@groupId" />

        <div class="row gap" style="margin: 8px 0 10px 0;">
            <button id="btnSelectAllAdd" class="btn btn-secondary" type="button">Zaznacz wszystkich</button>
            <button id="btnClearAllAdd" class="btn btn-secondary" type="button">Odznacz wszystkich</button>
        </div>

        <ul class="list" id="listAddUsers">
            @foreach (var u in Model)
            {
                <li class="list-item">
                    <label class="check" style="width:100%;">
                        <input type="checkbox" name="userIds" value="@u.UserId" @(u.IsMember ? "checked" : "") />
                        <span>@u.Email</span>
                        @if (u.IsMember)
                        {
                            <span class="badge">W GRUPIE</span>
                        }
                    </label>
                </li>
            }
        </ul>

        <div class="row gap" style="margin-top:12px;">
            <button class="btn" type="submit">Zapisz</button>
            <a class="btn btn-secondary" asp-action="Members" asp-route-id="@groupId">Anuluj</a>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        tcWireSearch("searchAddUsers", "#listAddUsers", ".list-item", "span");

        (function(){
            const all = () => Array.from(document.querySelectorAll('#listAddUsers input[type="checkbox"][name="userIds"]'));
            const selAll = document.getElementById("btnSelectAllAdd");
            const clrAll = document.getElementById("btnClearAllAdd");
            if (selAll) selAll.addEventListener("click", () => all().forEach(x => x.checked = true));
            if (clrAll) clrAll.addEventListener("click", () => all().forEach(x => x.checked = false));
        })();
    </script>
}
